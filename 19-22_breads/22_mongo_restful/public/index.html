<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JQuery Breads</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment-with-locales.min.js"
    integrity="sha512-LGXaggshOkD/at6PFNcp2V2unf9LzFq6LE+sChH7ceMTDP0g2kn6Vxwgg7wkPP7AAtX+lmPqPdxB47A0Nz0cMQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    td {
      line-height: 200%;
    }

    .table> :not(:last-child)> :last-child>* {
      border-bottom-color: #e7e7e7;
    }
  </style>
</head>

<body class="container my-4">
  <h1>BREADS (Browse, Read, Edit, Add, Delete, Sort)</h1>
  <form id="form-search" action="" method="get">
    <div class="card mb-2">
      <div class="card-header">
        <h2>Filters</h2>
      </div>
      <div class="card-body">
        <div class="mb-3 row">
          <div class="col-sm-2 d-flex align-items-center">
            <input class="form-check-input mt-0" type="checkbox" id="_idcheck" name="_idcheck" />
            <label for="_idcheck" class="col-form-label">ID</label>
          </div>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="_id" name="_id" value="" placeholder="ID" />
          </div>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2 d-flex align-items-center">
            <input class="form-check-input mt-0" type="checkbox" id="stringcheck" name="stringcheck" />
            <label for="stringcheck" class="col-form-label">String</label>
          </div>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="string" name="string" value="" placeholder="String" />
          </div>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2 d-flex align-items-center">
            <input class="form-check-input mt-0" type="checkbox" id="integercheck" name="integercheck" />
            <label for="integercheck" class="col-form-label">Integer</label>
          </div>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="integer" name="integer" value="" placeholder="Integer" />
          </div>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2 d-flex align-items-center">
            <input class="form-check-input mt-0" type="checkbox" id="floatcheck" name="floatcheck" />
            <label for="floatcheck" class="col-form-label">Float</label>
          </div>

          <div class="col-sm-10">
            <input type="text" class="form-control" id="float" name="float" value="" placeholder="Float" />
          </div>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2 d-flex align-items-center">
            <input class="form-check-input mt-0" type="checkbox" id="datecheck" name="datecheck" />
            <label for="datecheck" class="col-form-label">Date</label>
          </div>

          <div class="col-sm-10">
            <div class="row">
              <div class="col-sm-5">
                <input type="date" class="form-control" id="startdate" name="startdate" value="" />
              </div>
              <span class="col-sm-2 d-flex justify-content-center align-items-center">to</span>
              <div class="col-sm-5">
                <input type="date" class="form-control" id="enddate" name="enddate" value="" />
              </div>
            </div>
          </div>
        </div>

        <div class="mb-3 row">
          <div class="col-sm-2 d-flex align-items-center">
            <input class="form-check-input mt-0" type="checkbox" id="booleancheck" name="booleancheck" />
            <label for="booleancheck" class="col-form-label">Boolean</label>
          </div>

          <div class="col-sm-10">
            <select name="boolean" id="boolean" class="form-control">
              <option value="">Choose the boolean ...</option>
              <option value="false">False</option>
              <option value="true">True</option>
            </select>
          </div>
        </div>
      </div>
      <div class="card-footer">
        <button type="submit" class="btn btn-success">
          <i class="fas fa-search"></i> Search
        </button>
        <button type="button" class="btn btn-warning btn-reset">
          <i class="fas fa-sync"></i> Reset
        </button>
      </div>
    </div>
  </form>

  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
    data-bs-whatever="Form Add"><i class="fas fa-plus"></i> Add</button>

  <table id="table-users" class="table table-striped">
    <thead>
      <tr>
        <th><a class="link-dark text-decoration-none" href=""><i class="fas fa-sort"></i> ID</a></th>
        <th><a class="link-dark text-decoration-none" href=""><i class="fas fa-sort"></i> String</a></th>
        <th><a class="link-dark text-decoration-none" href=""><i class="fas fa-sort"></i> Integer</a></th>
        <th><a class="link-dark text-decoration-none" href=""><i class="fas fa-sort"></i> Float</a></th>
        <th><a class="link-dark text-decoration-none" href=""><i class="fas fa-sort"></i> Date</a></th>
        <th><a class="link-dark text-decoration-none" href=""><i class="fas fa-sort"></i> Boolean</a></th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <nav aria-label="Page navigation">
    <ul class="pagination"></ul>
  </nav>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">

        <form id="form-add" action='' method='post'>
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Form Add</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- <form action='' method='post'> -->
            <!-- <% if (title=='Edit Data' ) { %>
              <div class='mb-3 row'>
                <label for='id' class='col-sm-2 col-form-label'>ID</label>
                <div class='col-sm-10'>
                  <input type='text' class='form-control' id='id' name='id' value='<%= data.id %>' readonly>
                </div>
              </div>
              <% } %> -->
            <div class='mb-3 row'>
              <label for='string' class='col-sm-2 col-form-label'>String</label>
              <div class='col-sm-10'>
                <input type='text' class='form-control' id='string' name='string' value='' placeholder='String'>
              </div>
            </div>
            <div class='mb-3 row'>
              <label for='integer' class='col-sm-2 col-form-label'>Integer</label>
              <div class='col-sm-10'>
                <input type='number' class='form-control' id='integer' name='integer' value='' placeholder='Integer'>
              </div>
            </div>
            <div class='mb-3 row'>
              <label for='float' class='col-sm-2 col-form-label'>Float</label>
              <div class='col-sm-10'>
                <input type='number' step='any' class='form-control' id='float' name='float' value=''
                  placeholder='Float'>
              </div>
            </div>
            <div class='mb-3 row'>
              <label for='date' class='col-sm-2 col-form-label'>Date</label>
              <div class='col-sm-10'>
                <input type='date' class='form-control' id='date' name='date' value=''>
              </div>
            </div>
            <div class='mb-3 row'>
              <label for='boolean' class='col-sm-2 col-form-label'>Boolean</label>
              <div class='col-sm-10'>
                <select name='boolean' id='boolean' class='form-control'>
                  <option value='false'>False</option>
                  <option value='true'>True</option>
                </select>
              </div>
            </div>
            <!-- <button type='submit' class='btn btn-success'> Save</button> -->
            <!-- <button type='submit' class='btn btn-success'>
              <%= title=='Add Data' ? 'Save' : 'Update' %>
            </button> -->
            <!-- <a href='/' class='btn btn-warning'>Cancel</a> -->
            <!-- </form> -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Save</button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <script>
    moment.locale('id');

    let params = {
      page: 1,
      _idcheck: null,
      stringcheck: null,
      integercheck: null,
      floatcheck: null,
      datecheck: null,
      booleancheck: null,
      _id: null,
      string: null,
      integer: null,
      float: null,
      startdate: null,
      enddate: null,
      boolean: null,
      sortBy: '_id',
      sortMode: 'asc',
    };

    $(document).ready(function () {
      loadData();

      $('ul.pagination').on('click', '.page-item a', function (e) {
        e.preventDefault();
        const page = $(this).attr('datapage');
        params = {
          ...params,
          page,
        };
        loadData();
      });

      $('#form-search').submit(function (e) {
        e.preventDefault();
        $(this)
          .serializeArray()
          .forEach(item => {
            params = {
              ...params,
              [item.name]: item.value,
            };
          });
        loadData();
      });

      $('.btn-reset').click(function () {
        params = {
          page: 1,
          _idcheck: null,
          stringcheck: null,
          integercheck: null,
          floatcheck: null,
          datecheck: null,
          booleancheck: null,
          _id: null,
          string: null,
          integer: null,
          float: null,
          startdate: null,
          enddate: null,
          boolean: null,
          sortBy: '_id',
          sortMode: 'asc',
        }
        $('#form-search').trigger('reset');
        loadData();
      });

      var exampleModal = document.getElementById('exampleModal')
      exampleModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget
        var recipient = button.getAttribute('data-bs-whatever')
        var modalTitle = exampleModal.querySelector('.modal-title')
        var modalBodyInput = exampleModal.querySelector('.modal-body input')
        modalTitle.textContent = recipient
        // modalBodyInput.value = recipient
      });

      $('#form-add').submit(function (e) {
        e.preventDefault();
        let data = {};
        $(this)
          .serializeArray()
          .forEach(item => {
            data = {
              ...data,
              [item.name]: item.value,
            };
          });
        console.log(data);
        addData(data);
      });
    });

    // $(document).on('click', '#addpagebutton', function () {
    //   loadAddForm();
    // });

    // $(document).on('click', '.btn-cancel', function (event) {
    //   loadData();
    // });

    // $(document).on('click', '.btn-edit', function (event) {
    //   const id = $(this).attr('iditem');
    //   loadEditForm(id);
    // });

    // $(document).on('click', '.btn-delete', function () {
    //   deleteData($(this).attr('iditem'));
    // });

    // $(document).on('click', '.sortthead', function (event) {
    //   const sortString = $(this).attr('data-sort');
    //   sortTable(sortString);
    // });

    // $(document).on('submit', '#form-add', function (event) {
    //   event.preventDefault();
    //   let string = $('#string').val();
    //   let integer = $('#integer').val();
    //   let float = $('#float').val();
    //   let date = $('#date').val();
    //   let boolean = $('#boolean').val();

    //   const data = {
    //     string,
    //     integer,
    //     float,
    //     date,
    //     boolean,
    //   };

    //   addData(data);
    //   return false;
    // });

    // $(document).on('submit', '#form-edit', function (event) {
    //   event.preventDefault();
    //   let _id = $('#_id').val();
    //   let string = $('#string').val();
    //   let integer = $('#integer').val();
    //   let float = $('#float').val();
    //   let date = $('#date').val();
    //   let boolean = $('#boolean').val();

    //   const data = {
    //     _id,
    //     string,
    //     integer,
    //     float,
    //     date,
    //     boolean,
    //   };

    //   updateData(data);
    //   return false;
    // });

    // const loadAddForm = () => {
    //   let htmlAddForm = '';

    //   htmlAddForm += `
    //   <h1>Add Data</h1>

    //   <form id="form-add" action="" method="post">
    //     <div class="row mb-3 align-items-center justify-content-between">
    //       <div class="col-auto">
    //         <label class="form-check-label" for="string">String</label>
    //       </div>
    //       <div class="col-auto w-75">
    //         <input type="text" id="string" name="string" class="form-control" placeholder="String">
    //       </div>
    //     </div>

    //     <div class="row mb-3 align-items-center justify-content-between">
    //       <div class="col-auto">
    //         <label class="form-check-label" for="integer">Integer</label>
    //       </div>
    //       <div class="col-auto w-75">
    //         <input type="number" id="integer" class="form-control" placeholder="Integer">
    //       </div>
    //     </div>

    //     <div class="row mb-3 align-items-center justify-content-between">
    //       <div class="col-auto">
    //         <label class="form-check-label" for="float">Float</label>
    //       </div>
    //       <div class="col-auto w-75">
    //         <input type="number" id="float" class="form-control" placeholder="Float" step="any">
    //       </div>
    //     </div>

    //     <div class="row mb-3 align-items-center justify-content-between">
    //       <div class="col-auto">
    //         <label class="form-check-label" for="date">Date</label>
    //       </div>
    //       <div class="w-75">
    //         <div class="col-auto w-25">
    //           <input type="date" id="date" name="date" class="form-control" placeholder="Date" step="any">
    //         </div>
    //       </div>
    //     </div>

    //     <div class="row mb-3 align-items-center justify-content-between">
    //       <div class="col-auto">
    //         <label class="form-check-label" for="boolean">Boolean</label>
    //       </div>
    //       <div class="col-auto w-75">
    //         <select id="boolean" name="boolean" class="form-select" aria-label="Default select example">
    //           <option value="" disabled selected hidden>Choose the boolean ...</option>
    //           <option value="true">True</option>
    //           <option value="false">False</option>
    //         </select>
    //       </div>
    //     </div>

    //     <button class="btn btn-primary" type="submit">Save</button>
    //     <a class="btn btn-outline-secondary btn-cancel">Cancel</a>
    //   </form>
    //   `;

    //   $('#pagecontainer').html(htmlAddForm);
    // };

    // const loadEditForm = id => {
    //   let url = `http://localhost:3000/types/edit/${id}`;

    //   $.ajax({
    //     url,
    //   }).done(function (item) {
    //     const options = {
    //       year: 'numeric',
    //       month: 'long',
    //       day: 'numeric',
    //     };

    //     let htmlEditForm = '';

    //     htmlEditForm += `
    //       <h1>Edit Data</h1>

    //       <form id="form-edit" action="" method="post">
    //         <div class="row mb-3 align-items-center justify-content-between">
    //           <div class="col-auto">
    //             <label class="form-check-label" for="_id">ID</label>
    //           </div>
    //           <div class="col-auto w-75">
    //             <input disabled type="text" id="_id" value="${item._id}" class="form-control" placeholder="ID">
    //           </div>
    //         </div>

    //         <div class="row mb-3 align-items-center justify-content-between">
    //           <div class="col-auto">
    //             <label class="form-check-label" for="string">String</label>
    //           </div>
    //           <div class="col-auto w-75">
    //             <input value="${item.string }" type="text" id="string" name="string" class="form-control" placeholder="String">
    //           </div>
    //         </div>

    //         <div class="row mb-3 align-items-center justify-content-between">
    //           <div class="col-auto">
    //             <label class="form-check-label" for="integer">Integer</label>
    //           </div>
    //           <div class="col-auto w-75">
    //             <input value="${item.integer}" type="number" id="integer" class="form-control" placeholder="Integer">
    //           </div>
    //         </div>

    //         <div class="row mb-3 align-items-center justify-content-between">
    //           <div class="col-auto">
    //             <label class="form-check-label" for="float">Float</label>
    //           </div>
    //           <div class="col-auto w-75">
    //             <input value="${item.float}" type="number" id="float" class="form-control" placeholder="Float" step="any">
    //           </div>
    //         </div>

    //         <div class="row mb-3 align-items-center justify-content-between">
    //           <div class="col-auto">
    //             <label class="form-check-label" for="date">Date</label>
    //           </div>
    //           <div class="w-75">
    //             <div class="col-auto w-25">
    //               <input value="${item.date ? item.date : ''}" type="date" id="date" name="date" class="form-control" placeholder="Date" step="any">
    //             </div>
    //           </div>
    //         </div>

    //         <div class="row mb-3 align-items-center justify-content-between">
    //           <div class="col-auto">
    //             <label class="form-check-label" for="boolean">Boolean</label>
    //           </div>
    //           <div class="col-auto w-75">
    //             <select id="boolean" name="boolean" class="form-select" aria-label="Default select example">
    //               <option value="" disabled selected hidden>Choose the boolean ...</option>
    //               <option ${item.boolean && 'selected'} value="true">True</option>
    //               <option ${!item.boolean && 'selected'} value="false">False</option>
    //             </select>
    //           </div>
    //         </div>

    //         <button class="btn btn-primary" type="submit">Update</button>
    //         <a class="btn btn-outline-secondary btn-cancel">Cancel</a>
    //       </form>
    //     `;

    //     $('#pagecontainer').html(htmlEditForm);
    //   });
    // };

    const loadData = param => {
      $.ajax({
        url: '/types',
        method: 'GET',
        data: params,
        dataType: 'json',
      }).done(response => {
        let html = '';
        console.log(response.data);
        response.data.rows.forEach((item, index) => {
          html += `
          <tr>
            <td>${(response.data.page - 1) * 3 + index + 1}</td>
            <td>${item.string}</td>
            <td>${item.integer}</td>
            <td>${item.float}</td>
            <td>${item.date ? moment(item.date).format("LL") : 'kosong'}</td>
            <td>${item.boolean}</td>
            <td>
              <button type="button" class="btn btn-success btn-edit" dataid="${item._id}"><i class="fas fa-pencil"></i></button>
              <button type="button" class="btn btn-danger btn-delete" dataid="${item._id}"><i class="fas fa-trash"></i></button>
            </td>
          </tr>
          `;
        });
        $('#table-users tbody').html(html);
        pagination(response.data.page, response.data.pages);
      }).fail(() => {
        alert('terjadi kesalahan');
      });;
    };

    const addData = data => {
      $.ajax({
        url: '/types',
        method: 'POST',
        data,
      }).done(response => {
        console.log(response.data);
        $('#form-add')[0].reset();
        loadData();
      }).fail(() => {
        alert('terjadi kesalahan');
      });;
    };

    const updateData = data => {
      $.ajax({
        method: 'PUT',
        url: `http://localhost:3000/types/edit/${data._id}`,
        data,
      })
        .done(function () {
          loadData();
        })
        .fail(function (err) {
          alert(err);
        });
    };

    const deleteData = id => {
      $.ajax({
        method: 'DELETE',
        url: `http://localhost:3000/types/${id}`,
      })
        .done(function () {
          loadData();
        })
        .fail(function (err) {
          alert(err);
        });
    };

    const pagination = (page, pages) => {
      let html = `
      <li class="page-item">
        <a class="page-link" href="" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>`;

      for (let i = 1; i <= pages; i++) {
        html += `<li class="page-item${page == i ? ' active' : ''}"><a class="page-link" href="" datapage="${i}">${i}</a></li>`;
      }

      html += `
      <li class="page-item">
        <a class="page-link" href="" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>`;

      $('ul.pagination').html(html);
    };

    // function sortTable(sortString) {
    //   let [sortBy, oldSortBy, sortOrder, stringparam, pageNext] = sortString.split(',');
    //   if (sortBy == oldSortBy) {
    //     switch (sortOrder) {
    //       case 'asc':
    //         sortOrder = 'desc';
    //         break;
    //       case 'desc':
    //         sortOrder = '';
    //         break;
    //       default:
    //         sortOrder = 'asc';
    //         break;
    //     }
    //   } else {
    //     sortOrder = 'asc';
    //   }

    //   let filterParams = stringparam === 'undefined' ? '' : stringparam;
    //   let filterArr = filterParams.split('&');
    //   let filteredParam = filterArr.filter(filterElement => {
    //     return (
    //       !filterElement.startsWith('page') &&
    //       !filterElement.startsWith('sort') &&
    //       !filterElement.startsWith('order')
    //     );
    //   });
    //   filterParams = filteredParam.join('&');
    //   filterParams = filterParams ? '?' + filterParams : '';

    //   let param = {
    //     pageNext,
    //     filter: filterParams,
    //     sortBy,
    //     sortOrder,
    //   };
    //   loadData(param);
    // }
  </script>
</body>

</html>